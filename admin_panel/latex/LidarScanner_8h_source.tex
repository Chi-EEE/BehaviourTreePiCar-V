\hypertarget{LidarScanner_8h_source}{}\doxysection{Lidar\+Scanner.\+h}
\label{LidarScanner_8h_source}\index{/github/workspace/app/rpi/common/include/car/system/device/lidar/LidarScanner.h@{/github/workspace/app/rpi/common/include/car/system/device/lidar/LidarScanner.h}}
\mbox{\hyperlink{LidarScanner_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef LIDARSCANNER\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define LIDARSCANNER\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{LidarDevice_8h}{LidarDevice.h}}"{}}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <variant>}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <RPLidar.h>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <tl/expected.hpp>}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{Configuration_8h}{car/configuration/Configuration.h}}"{}}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{keyword}{using namespace }rplidar;}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacecar_1_1system_1_1device_1_1lidar}{car::system::device::lidar}}}
\DoxyCodeLine{19 \{}
\DoxyCodeLine{20     \textcolor{keyword}{class }\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner}{LidarScanner}} final : \textcolor{keyword}{public} \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarDevice}{LidarDevice}}}
\DoxyCodeLine{21     \{}
\DoxyCodeLine{22     \textcolor{keyword}{public}:}
\DoxyCodeLine{23         [[nodiscard]] \textcolor{keyword}{static} tl::expected<std::unique\_ptr<LidarScanner>, std::string> \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_ade253d31f5e290c59ef71b63a6834b80}{create}}(std::shared\_ptr<configuration::Configuration> configuration) \textcolor{keyword}{noexcept}}
\DoxyCodeLine{24         \{}
\DoxyCodeLine{25             \textcolor{keyword}{auto} maybe\_lidar = RPLidar::create(configuration-\/>lidar\_port);}
\DoxyCodeLine{26             \textcolor{keywordflow}{if} (maybe\_lidar.has\_value())}
\DoxyCodeLine{27             \{}
\DoxyCodeLine{28                 \textcolor{keywordflow}{return} std::make\_unique<LidarScanner>(configuration, std::move(maybe\_lidar.value()));}
\DoxyCodeLine{29             \}}
\DoxyCodeLine{30             \textcolor{keywordflow}{else}}
\DoxyCodeLine{31             \{}
\DoxyCodeLine{32                 \textcolor{keywordflow}{return} tl::make\_unexpected(maybe\_lidar.error());}
\DoxyCodeLine{33             \}}
\DoxyCodeLine{34         \}}
\DoxyCodeLine{35 }
\DoxyCodeLine{36         \textcolor{comment}{// Do not call this constructor directly. Use the create method instead.}}
\DoxyCodeLine{37         \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a7629b3dcb9559e1d77725bdf274378b6}{LidarScanner}}(std::shared\_ptr<configuration::Configuration> configuration, std::unique\_ptr<RPLidar> lidar) : \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a3633e4494c9c478648740a0e072b8bca}{configuration\_}}(configuration), \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_abd1a4b02c0a7c0e4963be0238a26813b}{lidar\_}}(std::move(lidar)) \{}
\DoxyCodeLine{38         \}}
\DoxyCodeLine{39 }
\DoxyCodeLine{40         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aa98622d9b544eac441c253131c237be8}{start}}() final\textcolor{keyword}{ override}}
\DoxyCodeLine{41 \textcolor{keyword}{        }\{}
\DoxyCodeLine{42             this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aaa3d7d954b61533b2981b155ed9b32f3}{running}} = \textcolor{keyword}{true};}
\DoxyCodeLine{43             this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_abd1a4b02c0a7c0e4963be0238a26813b}{lidar\_}}-\/>start\_motor();}
\DoxyCodeLine{44             std::lock\_guard<std::mutex> lock(this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a5f63208682e8f3d4f310a9ff4e5c346d}{scan\_data\_mutex\_}});}
\DoxyCodeLine{45             this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aec37127a322b877dc11c957a380fd97d}{scan\_generator\_}} = this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_abd1a4b02c0a7c0e4963be0238a26813b}{lidar\_}}-\/>iter\_scans();}
\DoxyCodeLine{46         \};}
\DoxyCodeLine{47 }
\DoxyCodeLine{48         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_ae6aa33a3d5e6f5ef777b6c7825e3cadd}{update}}() final\textcolor{keyword}{ override}}
\DoxyCodeLine{49 \textcolor{keyword}{        }\{}
\DoxyCodeLine{50             \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aaa3d7d954b61533b2981b155ed9b32f3}{running}}) \{}
\DoxyCodeLine{51                 std::lock\_guard<std::mutex> lock(this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a5f63208682e8f3d4f310a9ff4e5c346d}{scan\_data\_mutex\_}});}
\DoxyCodeLine{52                 \textcolor{keyword}{const} \textcolor{keyword}{auto}\& scan\_generator = std::get<std::function<std::vector<Measure>()>>(this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aec37127a322b877dc11c957a380fd97d}{scan\_generator\_}});}
\DoxyCodeLine{53                 this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarDevice_ab8e0582777e77b8dc84e497a14f6ba2a}{setScanData}}(scan\_generator());}
\DoxyCodeLine{54             \}}
\DoxyCodeLine{55         \};}
\DoxyCodeLine{56 }
\DoxyCodeLine{57         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a85b0c10f23b34d4fe4f1e6d4e63ccc41}{stop}}() final\textcolor{keyword}{ override}}
\DoxyCodeLine{58 \textcolor{keyword}{        }\{}
\DoxyCodeLine{59             \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aaa3d7d954b61533b2981b155ed9b32f3}{running}}) \{}
\DoxyCodeLine{60                 this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aaa3d7d954b61533b2981b155ed9b32f3}{running}} = \textcolor{keyword}{false};}
\DoxyCodeLine{61                 std::lock\_guard<std::mutex> lock(this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a5f63208682e8f3d4f310a9ff4e5c346d}{scan\_data\_mutex\_}});}
\DoxyCodeLine{62                 this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aec37127a322b877dc11c957a380fd97d}{scan\_generator\_}} = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{63                 this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_abd1a4b02c0a7c0e4963be0238a26813b}{lidar\_}}-\/>stop();}
\DoxyCodeLine{64                 this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_abd1a4b02c0a7c0e4963be0238a26813b}{lidar\_}}-\/>stop\_motor();}
\DoxyCodeLine{65             \}}
\DoxyCodeLine{66         \}}
\DoxyCodeLine{67 }
\DoxyCodeLine{68         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a49f725d669fdd6c25a626c2f799c50eb}{initialize}}() final\textcolor{keyword}{ override}}
\DoxyCodeLine{69 \textcolor{keyword}{        }\{}
\DoxyCodeLine{70         \};}
\DoxyCodeLine{71 }
\DoxyCodeLine{72         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a9fb93cf9d1206b5dedc4261fc30319f2}{disconnect}}() final\textcolor{keyword}{ override}}
\DoxyCodeLine{73 \textcolor{keyword}{        }\{}
\DoxyCodeLine{74             \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aaa3d7d954b61533b2981b155ed9b32f3}{running}}) \{}
\DoxyCodeLine{75                 this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aaa3d7d954b61533b2981b155ed9b32f3}{running}} = \textcolor{keyword}{false};}
\DoxyCodeLine{76                 std::lock\_guard<std::mutex> lock(this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a5f63208682e8f3d4f310a9ff4e5c346d}{scan\_data\_mutex\_}});}
\DoxyCodeLine{77                 this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aec37127a322b877dc11c957a380fd97d}{scan\_generator\_}} = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{78                 this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_abd1a4b02c0a7c0e4963be0238a26813b}{lidar\_}}-\/>disconnect();}
\DoxyCodeLine{79             \}}
\DoxyCodeLine{80         \}}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a61cc5adbce2d2da066198d32f7a18321}{terminate}}() final\textcolor{keyword}{ override}}
\DoxyCodeLine{83 \textcolor{keyword}{        }\{}
\DoxyCodeLine{84             this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a85b0c10f23b34d4fe4f1e6d4e63ccc41}{stop}}();}
\DoxyCodeLine{85             this-\/>\mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a9fb93cf9d1206b5dedc4261fc30319f2}{disconnect}}();}
\DoxyCodeLine{86         \}}
\DoxyCodeLine{87 }
\DoxyCodeLine{88     \textcolor{keyword}{private}:}
\DoxyCodeLine{89         std::atomic\_bool \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aaa3d7d954b61533b2981b155ed9b32f3}{running}} = \textcolor{keyword}{false};}
\DoxyCodeLine{90 }
\DoxyCodeLine{91         std::shared\_ptr<configuration::Configuration> \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a3633e4494c9c478648740a0e072b8bca}{configuration\_}};}
\DoxyCodeLine{92 }
\DoxyCodeLine{93         std::vector<Measure> \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a89b6cda450681d8bb7e8e74750682d7e}{scan\_data\_}};}
\DoxyCodeLine{94 }
\DoxyCodeLine{95         std::unique\_ptr<RPLidar> \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_abd1a4b02c0a7c0e4963be0238a26813b}{lidar\_}};}
\DoxyCodeLine{96         std::variant<std::function<std::vector<Measure>()>, nullptr\_t> \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_aec37127a322b877dc11c957a380fd97d}{scan\_generator\_}} = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{97     }
\DoxyCodeLine{98         std::mutex \mbox{\hyperlink{classcar_1_1system_1_1device_1_1lidar_1_1LidarScanner_a5f63208682e8f3d4f310a9ff4e5c346d}{scan\_data\_mutex\_}};}
\DoxyCodeLine{99     \};}
\DoxyCodeLine{100 \}}
\DoxyCodeLine{101 }
\DoxyCodeLine{102 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
